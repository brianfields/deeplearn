name: Test Workflow Validation

on:
  workflow_dispatch:  # Allow manual triggering
  push:
    branches: [ main, develop ]
    paths:
      - '.github/workflows/test-workflow.yml'

jobs:
  validate:
    runs-on: ubuntu-latest
    timeout-minutes: 5
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4

    - name: Validate workflow files
      run: |
        echo "✅ Workflow files created successfully"
        echo "Backend tests workflow: .github/workflows/backend-tests.yml"
        echo "MCQ tests workflow: .github/workflows/mcq-tests.yml"
        
    - name: Check backend structure
      run: |
        echo "📁 Backend structure:"
        ls -la backend/
        echo ""
        echo "🧪 Test files:"
        ls -la backend/tests/test_mcq_*.py
        echo ""
        echo "📝 Requirements:"
        head -20 backend/requirements.txt

    - name: Summary
      run: |
        echo "## 🚀 Workflow Setup Complete" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "### Created Workflows" >> $GITHUB_STEP_SUMMARY
        echo "1. **backend-tests.yml** - Comprehensive backend testing with PostgreSQL" >> $GITHUB_STEP_SUMMARY
        echo "2. **mcq-tests.yml** - Focused MCQ functionality testing" >> $GITHUB_STEP_SUMMARY
        echo "3. **test-workflow.yml** - This validation workflow" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "### Features" >> $GITHUB_STEP_SUMMARY
        echo "- 🐍 Python 3.11 support" >> $GITHUB_STEP_SUMMARY
        echo "- 🐘 PostgreSQL database service" >> $GITHUB_STEP_SUMMARY
        echo "- 📦 Pip dependency caching" >> $GITHUB_STEP_SUMMARY
        echo "- 🧪 Comprehensive test coverage" >> $GITHUB_STEP_SUMMARY
        echo "- 📊 Test result artifacts" >> $GITHUB_STEP_SUMMARY
        echo "- 🎯 Path-based triggering" >> $GITHUB_STEP_SUMMARY